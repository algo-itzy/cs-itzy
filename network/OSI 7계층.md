# OSI 7계층



## 계층은 왜 나눌까?

1. 다른 절차를 사용하던 통신을 하려고 하다보니 규격이 필요했다.
2. 통신이 일어나는 과정을 단계별로 파악할 수 있다.
3. 중간에 계층에 이상이 생기면 어떤 부분에서 오류가 났는지 상대적으로 알기가 쉽다.

   = 특정한 곳에 이상이 생기면 그 단계만 수정할 수 있다.



## 계층별로 데이터를 부르는 방법, PDU(Protocol Data Unit)

- Application Layer (HTTP) : 메세지
- Transport Layer (TCP) : 세그먼트 또는 데이터그램 (TCP → 세그먼트, UDP → 데이터그램)
- Network Layer (IP) : 패킷
- Data Link Layer (이더넷) : 프레임



## 1) 물리(Physical)

> 0과 1로 이루어진 데이터를 **전기적 신호로 바꿔** 전송

- 전송하는데 필요한 기능을 제공 ( 통신 케이블, 허브 )
- 비트단위 데이터(0, 1로 이루어짐)를 전기적 신호로 바꿈
- 즉, 비트단위 데이터를 아날로그 신호로 바꿔(encoding) 전송하거나 아날로그 신호가 들어오면 비트단위 데이터로 바꿈(decoding)

| 특징          | 설명                         |
| ------------- | ---------------------------- |
| PDU           | 비트(Bit)                    |
| 주요 프로토콜 | Modem, Cable, Fiber, RS-232C |
| 대표 장비     | 허브, 리피터, 케이블         |



## 2) 데이터 링크(Data Link)

> 송수신되는 정보의 **에러검출 / 재전송 / 흐름제어**

- 송/수신 확인. **MAC 주소**(Media Access Control)를 가지고 통신
- 동일한 네트워크에서의 전송을 담당
- 오류제어 : Frame(데이터 단위) 오류나면 버림

| 특징          | 설명                                       |
| ------------- | ------------------------------------------ |
| PDU           | 프레임(Frame)                              |
| 주요 프로토콜 | 이더넷, MAC, PPP, ATM, LAN, Wifi(무선 LAN) |
| 대표 장비     | 브릿지, 스위치                             |

#### MAC 주소란?

프레임에 주소값을 물리적으로 할당

#### 이더넷 프레임

이더넷 헤더 : **목적지 MAC, 출발지 MAC 주소**

FCS(Frame Check Sequence) : 에러 체크


## 3) 네트워크(Network)

> 경로를 선택하고 주소를 정하고 경로에 따라 패킷을 전달

- 데이터를 목적지까지 가장 안전하고 빠르게 전달하는 기능을 담당
- 데이터를 연결하는 다른 네트워크를 통해 전달함으로써 인터넷이 가능하게 만드는 계층
- 네트워크들 사이에서 데이터를 전송하는 역할
- 호스트에 IP번호를 부여, 목적지까지의 최적 경로 찾아줌

라우터 : 네트워크끼리 연결하고 데이터를 전송하는 기기

**라우팅 **: 라우터에 의한 네트워크 간 전송, **이동할 경로를 선택**, IP 주소를 지정한 뒤, 해당 경로에 따라 패킷을 전달

Forwarding : 자신 다음의 라우터에게 데이터를 넘겨줌

| 특징          | 설명              |
| ------------- | ----------------- |
| PDU           | 패킷(Packet)      |
| 주요 프로토콜 | IP, ICMP, ARP     |
| 대표 장비     | 라우터, L3 스위치 |

#### ARP란?

- IP 주소와 MAC 주소를 대응시키는 것 (주소해석)
- ARP 동작 흐름
  1. ARP 요청으로 IP 주소에 대응하는 MAC 주소를 질의
  2. 질의받은 IP 주소를 가진 호스트가 ARP 응답으로 MAC 주소 알려줌
  3. 주소 해석한 IP 주소와 MAC 주소의 대응을 ARP 캐시에 보존

#### IP 헤더

IP 주소 : 통신 상대가 되는 호스트를 식별하기 위한 식별 정보

IP 헤더에는 **출발지 IP 주소**, **목적지 IP 주소**(여러 개일 수 있음)를 반드시 지정해야 함.


## 4) 전송(Transport)

> 양 끝단의 사용자들이 데이터를 주고 받게 해주는 역할

- 데이터를 적절한 애플리케이션에 배분하는 역할
- 세그멘테이션 : 상위 계층 데이터를 세그먼트로 나눔
- 흐름제어 : 데이터전송량이 다른 기기에서의 전송량 제어
- 오류제어

TCP와 UDP 프로토콜을 통해 통신을 활성화, 프로그램들이 전송을 할 수 있도록 제공, **Port 번호 사용**

- TCP : 신뢰성, 연결지향적
- UDP : 비신뢰성, 비연결성, 실시간

| 특징          | 설명                  |
| ------------- | --------------------- |
| PDU           | 세그먼트(Segment)     |
| 주요 프로토콜 | TCP, UDP              |
| 대표 장       | 게이트웨이, L4 스위치 |

#### Port 번호란?

하나의 컴퓨터에서 동시에 실행되고 있는 프로세스들이 서로 겹치지 않게 설정되는 정수 값

#### TCP 헤더

**출발지, 목적지 포트 번호**, 플래그, 시퀀스 번호, ACK 번호

시퀀스 번호 : TCP로 전송하는 데이터 순서

ACK 번호 : 데이터를 바르게 수신했음을 확인하기 위해 사용

#### UDP 헤더

**출발지, 목적지 포트 번호**, 데이터그램 길이


## 5) 세션(Session)

> 통신장치 간의 상호작용을 설정하고 유지

- 통신 시스템 사용자간의 연결을 유지 및 설정
- 세션복구, 체크포인트 이용

| 특징          | 설명              |
| ------------- | ----------------- |
| PDU           | 데이터(Data)      |
| 주요 프로토콜 | NetBIOS, SSH, TLS |



## 6) 표현(Presentation)

> 코드 간의 번역을 담당(MIME 인코딩이나 암호화 등의 동작)

- 세션 계층 간의 주고받는 인터페이스를 일관성있게 제공
- 데이터 변환, 압축, 암호화
- 예시) 해당 데이터가 TEXT인지, 그림인지, GIF인지 JPG인지의 구분

| 특징          | 설명                |
| ------------- | ------------------- |
| PDU           | 데이터(Data)        |
| 주요 프로토콜 | JPG, MPEG, SMB, AFP |



## 7) 응용(Application)

> 사용자가 네트워크에 접근할 수 있도록 서비스 제공

- 인간이 인식할 수 있도록 데이터를 표현
- 애플리케이션 기능을 실행하기 위한 데이터의 형식과 처리 절차등을 결정하는 것

참고) 현대의 인터넷은 TCP/IP 모델을 따르고 있다. 따라서 TCP/IP 모델에서는 5, 6, 7계층을 묶어 Application layer라고 함.

| 특징          | 설명                                    |
| ------------- | --------------------------------------- |
| PDU           | 데이터(Data)                            |
| 주요 프로토콜 | HTTP, SMTP, POP3, IMAP4, DHCP, DNS, FTP |



## 캡슐화

#### 헤더

- 헤더 : 각 프로토콜의 처리를 하기 위한 제어 정보.
- 캡슐화 : 데이터에 헤더를 추가하는 것
- 역캡슐화 : 프로토콜이 데이터를 받으면, 각 프로토콜 헤더를 바탕으로 처리하여 헤더를 벗
  겨내고 다시 다른 프로토콜로 처리를 넘긴다



##### 물리적 신호로 변환

데이터를 보내는쪽은 TCP/IP 계층을 위에서부터 아래로 따라가며 각 프로토콜 헤더를 추가한
다.

1. 웹브라우저의 데이터는 HTTP 헤더로 캡슐화 되어 TCP로 넘어간다
2. TCP 헤더가 추가되고 다시 IP 헤더가 추가된다
3. 이더넷 헤더와 FCS(Frame Check Sequence)가 추가된다 :  FCS는 에러 체크를 위한 정보
4. 이더넷 규격에 해당하는 물리적 신호로 변환해 전송 매체로 내보낸다.

   

TCP/IP의 상위 계층 프로토콜에서부터 하위 계층 프로토콜의 헤더가 점차 캡슐화 된다.
네트워크로 내보내는 데이터에는 여러 프로토콜의 헤더가 추가된다.



#### 특징 정리

|      | Layer        | PDU     | 주요 프로토콜                              |
| ---- | ------------ | ------- | ------------------------------------------ |
| 1    | Physical     | Bit     | Modem, Cable, Fiber, RS-232C               |
| 2    | Data Link    | Frame   | 이더넷, MAC, PPP, ATM, LAN, Wifi(무선 LAN) |
| 3    | Network      | Packet  | IP, ICMP, ARP                              |
| 4    | Transport    | Segment | TCP, UDP                                   |
| 5    | Session      | Data    | NetBIOS, SSH, TLS                          |
| 6    | Presentation | Data    | JPG, MPEG, SMB, AFP                        |
| 7    | Application  | Data    | DHCP, DNS, FTP, HTTP                       |

1. 물리(Physical) : 0과 1로 이루어진 데이터를 **전기적 신호로 바꿔** 전송

2. 데이터 링크(Data Link) : 송수신되는 정보의 **에러검출 / 재전송 / 흐름제어**

3. 네트워크(Network) : **경로를 선택**하고 주소를 정하고 **경로에 따라** 패킷을 **전달**

4. 전송(Transport) : 양 끝단의 사용자들이 **데이터를 주고 받게** 해주는 역할

5. 세션(Session) : 통신장치 간의 **상호작용을 설정하고 유지**

6. 표현(Presentation) : 코드 간의 **번역**을 담당(MIME 인코딩이나 암호화 등의 동작)

7. 응용(Application) : **사용자**가 네트워크에 접근할 수 있도록 **서비스** 제공



#### 헤더 정리

|      | Layer       | Header에 있는 주요 내용                                      |
| ---- | ----------- | ------------------------------------------------------------ |
| 1    | Physical    | No header                                                    |
| 2    | Data Link   | FCS(Frame Check Sequence), checksum, data 길이 등            |
| 3    | Network     | IP protocol Version, 출발지/도착지 IP 주소, header checksum  |
| 4    | Transport   | Source Port, Destination Port, ACK number, Data Offset(데이터 시작 위치 나타냄) |
| 5    | Application | HTTP(일반 헤더, 요청/응답 헤더, Entity header)               |

